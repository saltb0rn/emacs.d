/*
  File: webpack.config.js

  This file is generated by Emacs with configurations from Salt Ho for Webpack.

  About configuration for webpack: https://webpack.js.org/configuration/.

*/
const path = require('path');
const webpack = require('webpack');
// package html files to dist directory: https://github.com/jantimon/html-webpack-plugin#options
const HtmlWebpackPlugin = require('html-webpack-plugin');
// build a api mocker: https://github.com/jaywcjlove/webpack-api-mocker/tree/master/example/webpack
const apiMocker = require('webpack-api-mocker');

module.exports = {
    mode: 'development',
    entry: {
        index: './src/index.js',
    },
    output: {
        path: path.resolve(__dirname, 'dist'),
        filename: '[name].bundle.js',
    },
    devtool: 'inline-source-map',
    devServer: {
        before(app) {
            apiMocker(
                app,
                path.resolve('./mocker/index.js'),
                /*
                {
                    proxy: {
                        '/repos/*': 'https://api.github.com',
                    },
                    changeHost: true,
                }
                ...
                */
                // We can put options here instead of putting them in './mocker/index.js'
            );
        },
        contentBase: path.resolve( __dirname, 'dist'),
        compress: true,
        inline: true,
        hot: true,
    },
    // about module, we can configure loaders here
    // https://webpack.js.org/configuration/module/
    module: {
        rules: [
            {
                test: /.js$/,
                exclude: /node_modules/,
                use: {
                    loader: 'babel-loader',
                    // about 'options' key
                    // https://webpack.js.org/configuration/module/#rule-options-rule-query
                    options: {
                        // about babel-present-env
                        // https://babeljs.io/docs/en/babel-preset-env
                        presets: [
                            [
                                '@babel/preset-env',
                                {
                                    // about browserslist reference
                                    // https://github.com/browserslist/browserslist
                                    // 'targets' : {
                                    //     'browsers': ['> 5%', 'not dead, last 2 versions'],
                                    // }
                                    'targets': '> 5%, not dead, last 2 versions',
                                },
                            ],
                        ],
                    },
                },
            },
            // {
            //     // new rule to be defined here
            // },
        ],
    },
    plugins: [
        // module hot reload, refresh module automatically while saving modifications.
        new webpack.HotModuleReplacementPlugin(),
        new HtmlWebpackPlugin({template: 'src/index.html'}),
    ],
};